- main_toolbar do |t|
  = t.edit resource

= form_tag do
  = field_set(:details) do
    = attributes_list stamps: false do |l|
      - l.attribute(:number)
      - l.attribute(:started_at)
      - l.attribute(:stopped_at)

  = field_set(:entries_to_point) do
    .active-list
      / Prepare more reconciliation letters than required
      %table.list.bank-reconciliation-items{ data: { next_letters: @bank_statement.cash_next_reconciliation_letters.take(@items.size) } }

        %thead
          %tr
            %th{colspan: 4}
            %th.center Débit
            %th.center Crédit
          %tr
            %th{colspan: 3}
            %th Solde initial du relevé
            %th.center= text_field_tag("bank_statement[initial_balance_debit]", @bank_statement.initial_balance_debit || 0.0, id: "initial_balance_debit", class: "center", data: { exclusive_nullify: "#initial_balance_credit" })
            %th.center= text_field_tag("bank_statement[initial_balance_credit]", @bank_statement.initial_balance_credit || 0.0, id: "initial_balance_credit", class: "center", data: { exclusive_nullify: "#initial_balance_debit" })

        %tfoot
          %tr
            %td.add-bank-statement-item-cont{colspan: 3}
              = date_field_tag "add-bank-statement-item-date", nil, id: "add-bank-statement-item-date", data: { label: "Ajouter une ligne" }
            %td Total rapproché
            %td.center 0.0
            %td.center 0.0
          %tr.remaining-reconciliation-balance
            %td{colspan: 3}
            %td Reste à rapprocher
            %td.center 0.0
            %td.center 0.0
          %tr
            %td{colspan: 3}
            %td Solde final
            %td.center{ data: { use: "#initial_balance_debit,.bank-statement-item-type .debit" } } 0.0
            %td.center{ data: { use: "#initial_balance_credit,.bank-statement-item-type .credit" } } 0.0

        %tbody.items
          = render partial: "reconciliation_date_section" # template used by JS
          - @items_grouped_by_date.each do |date, items|
            = render partial: "reconciliation_date_section", locals: { date: date }
            - items.each do |item|
              - if BankStatementItem === item
                %tr.bank-statement-item-type{ class: "#{item.id}-bank-statement-item" }
                  %td.hidden= hidden_field_tag "items[#{item.id}][name]", item.name
                  %td.hidden= hidden_field_tag "items[#{item.id}][transfered_on]", item.transfered_on
                  %td.hidden= hidden_field_tag "items[#{item.id}][debit]", item.debit
                  %td.hidden= hidden_field_tag "items[#{item.id}][credit]", item.credit
                  %td.hidden= hidden_field_tag "items[#{item.id}][letter]", item.letter, class: "bank-statement-letter"
                  %td.hidden= hidden_field_tag "items[#{item.id}][initiated_on]", item.initiated_on
                  %td.hidden= hidden_field_tag "items[#{item.id}][transaction_number]", item.transaction_number

                  %td.del
                    = link_to "#", class: "destroy" do
                      %i
                  %td.type-icon
                    %i
                  %td.name= item.name
                  %td
                  %td.center.debit= item.debit || 0.0
                  %td.center.credit= item.credit || 0.0
                  %td.center.bank-statement-letter= item.letter
                  %td.clear
                    %a{ href: "#" }
                      %i
                      Effacer
                  %td

              - else
                %tr.journal-entry-item-type
                  %td.hidden= hidden_field_tag "journal_entry_items[#{item.id}][bank_statement_letter]", item.bank_statement_letter, class: "bank-statement-letter"
                  %td.del
                  %td.type-icon
                    %i
                  %td.name= item.name
                  %td
                  %td.center.debit= item.real_debit || 0.0
                  %td.center.credit= item.real_credit || 0.0
                  %td.center.bank-statement-letter= item.bank_statement_letter
                  %td.clear
                    %a{ href: "#" }
                      %i
                      Effacer
                  %td.complete
                    %a{ href: "#" }
                      Compléter

  = form_actions do
    = submit_tag :save.tl
    = link_to :cancel.tl, :back, class: "btn"
